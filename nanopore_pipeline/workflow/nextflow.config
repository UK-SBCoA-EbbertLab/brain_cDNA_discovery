// CONFIGURATION FILE


// Pipeline parameter default values, can be modified by user when calling pipeline on command line (e.g. --data_fq sample_1.fastq) ##
params.ont_reads_fq = 'None'
params.ont_reads_txt = 'None'
params.ref = 'None'
params.housekeeping = 'None'
params.annotation = 'None'
params.out_dir = "output_directory/"
params.is_chm13 = "False"
params.fast5_dir = 'None'
params.basecall_id = "None"
params.basecall_config = "None"
params.ercc = "None"
params.cdna_kit = "None"
params.multiqc_config = "None"
params.is_discovery = "None"
params.NDR = "auto"
params.bambu_track_reads = "False"

process { 


    withLabel: tiny {
        executor='slurm'
        clusterOptions='--partition normal --time 00:15:00 --account coa_mteb223_uksr --nodes 1 --ntasks 4 --mem 20G --exclude rome008'
    }



    withLabel: small {
        executor='slurm'
        clusterOptions='--partition normal --time 1:00:00 --account coa_mteb223_uksr --nodes 1 --ntasks 8 --mem 40G --exclude rome008'
    }



    // Define job scheduler parameters for jobs that require lots of computation/memory ##

    withLabel: medium_small {
        
        executor='slurm'
        clusterOptions='--partition normal --time 23:00:00 --account coa_mteb223_uksr --nodes 1 --ntasks 12 --mem 48G --exclude rome008'
        }


    // Define job scheduler parameters for jobs that require normal ammounts of computation/memory ##

    withLabel: medium {
        executor='slurm'
        clusterOptions='--partition normal --time 23:00:00 --account coa_mteb223_uksr --nodes 1 --ntasks 16 --mem 64G --exclude rome008'
        }

    withLabel: medium_large {
        executor='slurm'
        clusterOptions='--partition normal --time 23:00:00 --account coa_mteb223_uksr --nodes 1 --ntasks 20 --mem 80G --exclude rome008'
    }

    withLabel: large {
        executor='slurm'
        clusterOptions='--partition normal --time 23:00:00 --account coa_mteb223_uksr --nodes 1 --ntasks 50 --mem 200G --exclude rome008'
    }

    withLabel: huge {
        executor='slurm'
        clusterOptions='--partition normal --time 23:00:00 --account coa_mteb223_uksr --nodes 1 --ntasks 8 --mem 500G --exclude=rome008'
    }

    // Define cluster options for BAMBU_DUSCOVERY and BAMBU_QUANT
    withLabel: huge_long {
        executor='slurm'
        clusterOptions='--partition normal --time 7-00:00:00 --account coa_mteb223_uksr --nodes 1 --mem-per-cpu 500G --ntasks 1 --cpus-per-task 1'
    }


    withLabel: local {
        executor='local'
    }

    withLabel: gpu {
        clusterOptions='--partition P4V12_SKY32M192_L --time 00:15:00 --account gol_mteb223_uksr --gres=gpu:1 --mem 16G'
    }

    // Define the singularity containers for each process

    // Nanopore
    withName: "(GFFCOMPARE|MAKE_INDEX_cDNA|MINIMAP2_cDNA|MINIMAP2_QC|PYCHOPPER|STRINGTIE_ONT_cDNA|MAKE_FAI|MAKE_TRANSCRIPTOME)" {
        container = "library://ebbertlab/nanopore_cdna/nanopore:sha256.e8cb0f02b0e8b3f89937e88333f3c410eff3eacc53d861f5c04a1768790c6a21"
    }

    // Quality Control
    withName: "(MULTIQC_GRCh38|MULTIQC_CHM13|RSEQC|PYCOQC|DECOMPRESS|TRIM_GALORE|CHM13_GTF_ERCC|CHM13_GTF|MULTIQC_GRCh38_NOPYCO|MULTIQC_CHM13_NOPYCO)" {
        container = "library://ebbertlab/nanopore_cdna/quality_control:sha256.2db86def19a30f36a55ffbf8f999803cace938388f13a0c861c3f75efe49f1e7"
    }

    // Basecalling
    withName: "(BASECALL|GATHER_BASECALL)" {
        container = "library://ebbertlab/nanopore_cdna/guppy:sha256.80d73ed421e17199390658662453c2c37c8e64435d8b402822a107247882915f"
        singularity.runOptions='--nv'
    }

    // Bambu
    withName: "(BAMBU_PREP_DISCOVERY|BAMBU_PREP_QUANT|BAMBU_DISCOVERY|BAMBU_QUANT)" {
        container = "library://ebbertlab/nanopore_cdna/bambu:sha256.c766826dd183d2c09be2ae4b64524954cecc66ea31557483fda249dd34c21c1d"
    }

}



// Define executor type and maximum queue size for jobs at once ##

executor {

    name="slurm"
    queueSize = 50
}

// Point to singularity image with the tools necessary to run the pipeline

singularity {
    
    enabled = true
}

